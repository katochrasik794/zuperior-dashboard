// server/prisma/schema.prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id               String      @id @default(uuid())
  clientId         String      @unique @default(cuid())
  email            String      @unique
  password         String      // Hashed password
  name             String?
  phone            String?
  country          String?
  createdAt        DateTime    @default(now())
  accounts         Account[]
  transactions     Transaction[]
  kyc              KYC?
  mt5Accounts      MT5Account[]
}

model Account {
  id               String      @id @default(uuid())
  accountId        String      @unique // MT5 Account ID
  platform         String      @default("MT5")
  leverage         Int
  balance          Float
  equity           Float
  userId           String
  user             User        @relation(fields: [userId], references: [id])
}

model Transaction {
  id               String      @id @default(uuid())
  type             String      // "Deposit" or "Withdrawal"
  amount           Float
  status           String      // "Pending", "Completed", "Failed"
  user             User        @relation(fields: [userId], references: [id])
  userId           String
  createdAt        DateTime    @default(now())
}

model KYC {
  id               String      @id @default(uuid())
  isDocumentVerified Boolean   @default(false)
  isAddressVerified  Boolean   @default(false)
  verificationStatus String      @default("Pending")
  user             User        @relation(fields: [userId], references: [id])
  userId           String      @unique
}

model MT5Account {
  id               String      @id @default(uuid())
  accountId        String      @unique // MT5 Account ID
  platform         String      @default("MT5")
  leverage         Int         @default(100)
  balance          Float       @default(0)
  equity           Float       @default(0)
  credit           Float       @default(0)
  margin           Float       @default(0)
  marginFree       Float       @default(0)
  marginLevel      Float       @default(0)
  profit           Float       @default(0)
  groupName        String
  isEnabled        Boolean     @default(true)
  userId           String
  user             User        @relation(fields: [userId], references: [id])
  transactions     MT5Transaction[]
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
}

model MT5Transaction {
  id               String      @id @default(uuid())
  type             String      // "Deposit" or "Withdrawal"
  amount           Float
  status           String      @default("pending") // "pending", "completed", "failed"
  paymentMethod    String?     // "crypto", "card", "bank"
  transactionId    String?     // External payment gateway ID
  comment          String?
  mt5Account       MT5Account  @relation(fields: [mt5AccountId], references: [id])
  mt5AccountId     String
  createdAt        DateTime    @default(now())
}
